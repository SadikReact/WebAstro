(this["webpackJsonpflone-react"]=this["webpackJsonpflone-react"]||[]).push([[137],{1271:function(t,e,a){"use strict";a.r(e);var n=a(93),o=a(198),r=a(199),i=a(201),c=a(200),l=a(146),s=a(209),u=a(202),d=a(0),h=a.n(d),m=a(664),f=a(715),v=(a(768),a(203)),g=a(214),p=a.n(g),y=a(2),b=a(53);h.a.Component;var E=function(t){function e(t){var a,n,r,s;return Object(o.a)(this,e),n=this,r=e,s=[t],r=Object(l.a)(r),(a=Object(i.a)(n,Object(c.a)()?Reflect.construct(r,s||[],Object(l.a)(n).constructor):r.apply(n,s))).state={userChatList:[],Activeastro:{},index:""},a}return Object(u.a)(e,t),Object(r.a)(e,[{key:"render",value:function(){return h.a.createElement(h.a.Fragment,null,this.props.roomChatData.length?this.props.roomChatData.map((function(t,e){return h.a.createElement(h.a.Fragment,null,"user"===t.type?h.a.createElement("div",{className:"message me"},h.a.createElement("div",{className:"message-body"},t.msg)):h.a.createElement("div",{className:"message"},h.a.createElement("div",{className:"message-body"},t.msg)))})).reverse():null)}}]),e}(h.a.Component),w=a(217),C=a(674),S=a.n(C);function I(){I=function(){return e};var t,e={},a=Object.prototype,n=a.hasOwnProperty,o=Object.defineProperty||function(t,e,a){t[e]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",c=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function s(t,e,a){return Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,a){return t[e]=a}}function u(t,e,a,n){var r=e&&e.prototype instanceof g?e:g,i=Object.create(r.prototype),c=new L(n||[]);return o(i,"_invoke",{value:j(t,a,c)}),i}function d(t,e,a){try{return{type:"normal",arg:t.call(e,a)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var h="suspendedStart",m="executing",f="completed",v={};function g(){}function p(){}function y(){}var b={};s(b,i,(function(){return this}));var E=Object.getPrototypeOf,w=E&&E(E(_([])));w&&w!==a&&n.call(w,i)&&(b=w);var C=y.prototype=g.prototype=Object.create(b);function S(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function a(o,r,i,c){var l=d(t[o],t,r);if("throw"!==l.type){var s=l.arg,u=s.value;return u&&"object"==typeof u&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){a("next",t,i,c)}),(function(t){a("throw",t,i,c)})):e.resolve(u).then((function(t){s.value=t,i(s)}),(function(t){return a("throw",t,i,c)}))}c(l.arg)}var r;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){a(t,n,e,o)}))}return r=r?r.then(o,o):o()}})}function j(e,a,n){var o=h;return function(r,i){if(o===m)throw new Error("Generator is already running");if(o===f){if("throw"===r)throw i;return{value:t,done:!0}}for(n.method=r,n.arg=i;;){var c=n.delegate;if(c){var l=N(c,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var s=d(e,a,n);if("normal"===s.type){if(o=n.done?f:"suspendedYield",s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=f,n.method="throw",n.arg=s.arg)}}}function N(e,a){var n=a.method,o=e.iterator[n];if(o===t)return a.delegate=null,"throw"===n&&e.iterator.return&&(a.method="return",a.arg=t,N(e,a),"throw"===a.method)||"return"!==n&&(a.method="throw",a.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var r=d(o,e.iterator,a.arg);if("throw"===r.type)return a.method="throw",a.arg=r.arg,a.delegate=null,v;var i=r.arg;return i?i.done?(a[e.resultName]=i.value,a.next=e.nextLoc,"return"!==a.method&&(a.method="next",a.arg=t),a.delegate=null,v):i:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,v)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function _(e){if(e||""===e){var a=e[i];if(a)return a.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,r=function a(){for(;++o<e.length;)if(n.call(e,o))return a.value=e[o],a.done=!1,a;return a.value=t,a.done=!0,a};return r.next=r}}throw new TypeError(typeof e+" is not iterable")}return p.prototype=y,o(C,"constructor",{value:y,configurable:!0}),o(y,"constructor",{value:p,configurable:!0}),p.displayName=s(y,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,s(t,l,"GeneratorFunction")),t.prototype=Object.create(C),t},e.awrap=function(t){return{__await:t}},S(O.prototype),s(O.prototype,c,(function(){return this})),e.AsyncIterator=O,e.async=function(t,a,n,o,r){void 0===r&&(r=Promise);var i=new O(u(t,a,n,o),r);return e.isGeneratorFunction(a)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},S(C),s(C,l,"Generator"),s(C,i,(function(){return this})),s(C,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),a=[];for(var n in e)a.push(n);return a.reverse(),function t(){for(;a.length;){var n=a.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=_,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(x),!e)for(var a in this)"t"===a.charAt(0)&&n.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var a=this;function o(n,o){return c.type="throw",c.arg=e,a.next=n,o&&(a.method="next",a.arg=t),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(l&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var i=r?r.completion:{};return i.type=t,i.arg=e,r?(this.method="next",this.next=r.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var a=this.tryEntries[e];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),x(a),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var a=this.tryEntries[e];if(a.tryLoc===t){var n=a.completion;if("throw"===n.type){var o=n.arg;x(a)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,a,n){return this.delegate={iterator:_(e),resultName:a,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}var O=function(t){function e(t){var a,r,u,d;return Object(o.a)(this,e),r=this,u=e,d=[t],u=Object(l.a)(u),(a=Object(i.a)(r,Object(c.a)()?Reflect.construct(u,d||[],Object(l.a)(r).constructor):u.apply(r,d))).formatTime=function(t){var e="0".concat(t%60).slice(-2),a="".concat(Math.floor(t/60)),n="0".concat(a%60).slice(-2),o="0".concat(Math.floor(t/3600)).slice(-2);return"".concat(o," : ").concat(n," : ").concat(e)},a.handlestartinterval=function(){a.apicall.current=setInterval((function(){Object(w.a)()}),5e4)},a.handleStart=function(){a.setState({counterState:!1}),a.countRef.current=setInterval((function(){a.setState({setTimer:a.state.setTimer+1})}),1e3)},a.handlePause=function(){clearInterval(a.countRef.current),clearInterval(a.apicall.current)},a.handlestop=function(){var t=localStorage.getItem("astroId");a.handlePause();var e={userId:JSON.parse(localStorage.getItem("user_id")),astroId:t};b.a.post("/user/changeStatus",e).then((function(t){console.log(t.data),sessionStorage.setItem("typeofcall","Chat"),a.props.history.push("/astrorating")})).catch((function(t){console.log(t.response)}))},a.getChatonedata=function(){setInterval((function(){var t=localStorage.getItem("astroId"),e=JSON.parse(localStorage.getItem("user_id"));b.a.get("/user/getone_chat/".concat(e,"/").concat(t)).then((function(t){var e,n,o;(null===(e=t.data.data)||void 0===e?void 0:e.roomid)&&(a.setState({roomId:null===(n=t.data.data)||void 0===n?void 0:n.roomid}),b.a.get("/user/allchatwithuser/".concat(null===(o=t.data.data)||void 0===o?void 0:o.roomid)).then((function(t){})).catch((function(t){console.log(t)})))}))}),3e3)},a.componentDidMount=function(){var t=localStorage.getItem("astroId"),e=JSON.parse(localStorage.getItem("user_id"));a.getChatonedata(),b.a.get("/user/getone_chat/".concat(e,"/").concat(t)).then((function(t){var e,n,o,r;(console.log(t.data),null===(e=t.data.data)||void 0===e?void 0:e.roomid)&&(a.setState({CurrentRoomid:null===(n=t.data.data)||void 0===n?void 0:n.roomid}),b.a.get("/user/allchatwithuser/".concat(null===(o=t.data)||void 0===o||null===(r=o.data)||void 0===r?void 0:r.roomid)).then((function(t){a.setState({roomChatData:t.data.data})})).catch((function(t){console.log(t)})))})).catch((function(t){console.log(t)})),b.a.get("/admin/getoneAstro/".concat(t)).then((function(t){var e;a.setState({Activeastro:null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.data})})).catch((function(t){console.log(t)}));if(localStorage.getItem("minute")){var n=localStorage.getItem("minute");a.setState({minutes:n,seconds:60*n}),a.startTimer(),a.secondsToTime(60*n)}localStorage.getItem("user_id");b.a.get("/user/getroomid/".concat(e)).then((function(t){!0===t.data.status&&a.setState({data:t.data.data,fullname:t.data.data.fullname,userimg:t.data.data.userimg,time:""})})).catch((function(t){console.log(t)}))},a.getChatRoom=function(t,e){a.setState({Historydata:e});var n=JSON.parse(localStorage.getItem("user_id")),o={astroid:null===t||void 0===t?void 0:t._id,msg:a.state.msg};""!=a.state.CurrentRoomid?b.a.get("/user/allchatwithuser/".concat(a.state.CurrentRoomid)).then((function(t){var e;console.log(null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.data),a.handlelivechat(),!0===t.data.status&&a.setState({roomChatData:null===t||void 0===t?void 0:t.data.data})})).catch((function(t){console.log(t)})):b.a.post("/user/addchat/".concat(n),o).then((function(t){var e,n,o,r,i,c;(console.log("chat",t.data),a.setState({CurrentRoomid:null===t||void 0===t||null===(e=t.data)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.roomid}),console.log("chat",null===t||void 0===t||null===(o=t.data)||void 0===o||null===(r=o.data)||void 0===r?void 0:r.roomid),!0===t.data.status)&&(a.setState({msg:""}),b.a.get("/user/allchatwithuser/".concat(null===t||void 0===t||null===(i=t.data)||void 0===i||null===(c=i.data)||void 0===c?void 0:c.roomid)).then((function(t){var e;a.handlelivechat(),console.log(null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.data),!0===t.data.status&&a.setState({roomChatData:null===t||void 0===t?void 0:t.data.data})})).catch((function(t){console.log(t)})))})).catch((function(t){console.log(t)}))},a.handlePreviouschat=function(){console.log("currentroomid",a.state.CurrentRoomid),b.a.get("/user/allchatwithuser/".concat(a.state.CurrentRoomid)).then((function(t){var e;console.log(null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.data),!0===t.data.status&&a.setState({roomChatData:null===t||void 0===t?void 0:t.data.data})})).catch((function(t){console.log(t)}))},a.handlechat=function(){if(a.state.CurrentRoomid)b.a.get("/user/allchatwithuser/".concat(a.state.CurrentRoomid)).then((function(t){var e;console.log(null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.data),!0===t.data.status&&a.setState({roomChatData:null===t||void 0===t?void 0:t.data.data})})).catch((function(t){console.log(t)}));else{var t=JSON.parse(localStorage.getItem("user_id"));b.a.get("/user/getroomid/".concat(t)).then((function(t){var e;console.log(t.data.data),a.setState({CurrentRoomid:null===(e=t.data.data)||void 0===e?void 0:e.roomid})})).catch((function(t){console.log(t)}))}},a.handlelivechat=function(){setInterval((function(){a.handlechat()}),2e3)},a.getChatRoomId=function(){var t=Object(n.a)(I().mark((function t(e,n){var o,r,i;return I().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log(e),a.setState({Historydata:!0}),a.setState({sendbutton:null===(o=e.astroid)||void 0===o?void 0:o._id}),a.setState({Index:n}),localStorage.setItem("videoCallAstro_id",null===e||void 0===e||null===(r=e.astroid)||void 0===r?void 0:r._id),a.setState({astroId:null===e||void 0===e||null===(i=e.astroid)||void 0===i?void 0:i._id,CurrentRoomid:null===e||void 0===e?void 0:e.roomid}),a.handlePreviouschat();case 7:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),a.submitHandler=function(){var t=Object(n.a)(I().mark((function t(e){var n,o,r;return I().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.preventDefault(),console.log("sumittttt"),n=localStorage.getItem("astroId"),""!==(o=JSON.parse(localStorage.getItem("user_id")))&&null!==o&&(""!==a.state.msg?(r={astroid:n,msg:a.state.msg},console.log("obj",r),b.a.post("/user/addchat/".concat(o),r).then((function(t){var e,n;(a.setState({chatRoomdata:t.data.data}),!0===t.data.status)&&(a.setState({msg:""}),b.a.get("/user/allchatwithuser/".concat(null===(e=t.data)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.roomid)).then((function(t){var e;(a.state.counterState&&a.handleStart(),a.handlestartinterval(),!0===t.data.status)&&(a.setState({roomChatData:null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.data}),a.handlelivechat())})).catch((function(t){console.log(t)})))})).catch((function(t){console.log(t)}))):S()("Input filed is blank","Fill it before send"));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),a.handleChange=function(t){a.setState({msg:t.target.value})},a.countRef=h.a.createRef(),a.apicall=h.a.createRef(),a.callmsg=h.a.createRef(),a.state={Index:"",chatRoomdata:{},Historydata:!1,setTimer:0,counterState:!0,data:{},sendbutton:"",Activeastro:{},CurrentRoomid:"",roomChatData:[],userId:"",astroId:"",msg:"hello",roomId:"",time:{},seconds:900,minutes:15},a.timer=0,a.startTimer=a.startTimer.bind(Object(s.a)(a)),a.countDown=a.countDown.bind(Object(s.a)(a)),a}return Object(u.a)(e,t),Object(r.a)(e,[{key:"secondsToTime",value:function(t){var e=t%3600,a=e%60;return{h:Math.floor(t/3600),m:Math.floor(e/60),s:Math.ceil(a)}}},{key:"startTimer",value:function(){0===this.timer&&this.state.seconds>0&&(this.timer=setInterval(this.countDown,1e3))}},{key:"countDown",value:function(){var t=0!==this.state.seconds?this.state.seconds-1:alert("out time");this.setState({time:this.secondsToTime(t),seconds:t}),0===t&&clearInterval(this.timer)}},{key:"render",value:function(){var t,e,a,n,o,r,i=this,c=this.state;c.timeout,c.enabled,c.count;return h.a.createElement(v.a,{headerTop:"visible"},h.a.createElement("section",{className:"app-chatbg"},h.a.createElement(m.a,null,h.a.createElement("div",{className:"app rt-chat"},!0===this.state.Historydata?h.a.createElement(h.a.Fragment,null,h.a.createElement("div",{className:"messages"},h.a.createElement("div",{className:"chat-header"},h.a.createElement("p",null,h.a.createElement("span",null,h.a.createElement("img",{src:this.state.roomChatData.length>0?null===(t=this.state.roomChatData[0])||void 0===t||null===(e=t.astroid)||void 0===e?void 0:e.img[0]:p.a,className:"app-img",alt:""})),this.state.roomChatData.length>0?null===(a=this.state.roomChatData[0])||void 0===a||null===(n=a.astroid)||void 0===n?void 0:n.fullname:null),h.a.createElement("span",{className:"appchattimer"},h.a.createElement("p",null,this.formatTime(this.state.setTimer)))),h.a.createElement("div",{className:"messages-history"},h.a.createElement(E,{roomChatData:this.state.roomChatData.length>0?this.state.roomChatData:[]})),localStorage.getItem("astroId")===this.state.sendbutton?h.a.createElement(h.a.Fragment,null,h.a.createElement("form",{className:"messages-inputs"},h.a.createElement("input",{type:"text",placeholder:"Send a message",onChange:function(t){i.handleChange(t)},value:this.state.msg}),h.a.createElement("button",{onClick:function(t){i.submitHandler(t,i.state.astroId,i.state.userId)}},h.a.createElement("i",{className:"material-icons"},"send")))):null)):h.a.createElement(h.a.Fragment,null,h.a.createElement("div",{className:"messages"},h.a.createElement("div",{className:"chat-header"},h.a.createElement("p",null,h.a.createElement("span",null,h.a.createElement("img",{src:null===(o=this.state.Activeastro)||void 0===o?void 0:o.img,className:"app-img",alt:""})),null===(r=this.state.Activeastro)||void 0===r?void 0:r.fullname),h.a.createElement("span",{className:"appchattimer"},h.a.createElement("p",null,this.formatTime(this.state.setTimer)))),h.a.createElement("div",{className:"messages-history"},h.a.createElement(E,{roomChatData:this.state.roomChatData.length>0?this.state.roomChatData:[]})),h.a.createElement("form",{className:"messages-inputs"},h.a.createElement("input",{type:"text",placeholder:"Send a message",onChange:function(t){i.handleChange(t)},value:this.state.msg}),h.a.createElement("button",{onClick:function(t){i.submitHandler(t,i.state.astroId,i.state.userId)}},h.a.createElement("i",{className:"material-icons"},"send")))))),h.a.createElement("div",{className:"chat-bottom"},h.a.createElement(y.c,{to:"/astrorating"},h.a.createElement(f.a,{onClick:function(){return i.handlestop()},color:"primary"},"Close Chat"))))))}}]),e}(h.a.Component);e.default=O},715:function(t,e,a){"use strict";var n=a(7),o=a(15),r=a(207),i=a(19),c=a(0),l=a.n(c),s=a(4),u=a.n(s),d=a(77),h=a.n(d),m=a(58),f=["active","aria-label","block","className","close","cssModule","color","outline","size","tag","innerRef"],v={active:u.a.bool,"aria-label":u.a.string,block:u.a.bool,color:u.a.string,disabled:u.a.bool,outline:u.a.bool,tag:m.n,innerRef:u.a.oneOfType([u.a.object,u.a.func,u.a.string]),onClick:u.a.func,size:u.a.string,children:u.a.node,className:u.a.string,cssModule:u.a.object,close:u.a.bool},g=function(t){function e(e){var a;return(a=t.call(this,e)||this).onClick=a.onClick.bind(Object(r.a)(a)),a}Object(i.a)(e,t);var a=e.prototype;return a.onClick=function(t){if(!this.props.disabled)return this.props.onClick?this.props.onClick(t):void 0;t.preventDefault()},a.render=function(){var t=this.props,e=t.active,a=t["aria-label"],r=t.block,i=t.className,c=t.close,s=t.cssModule,u=t.color,d=t.outline,v=t.size,g=t.tag,p=t.innerRef,y=Object(o.a)(t,f);c&&"undefined"===typeof y.children&&(y.children=l.a.createElement("span",{"aria-hidden":!0},"\xd7"));var b="btn"+(d?"-outline":"")+"-"+u,E=Object(m.j)(h()(i,{close:c},c||"btn",c||b,!!v&&"btn-"+v,!!r&&"btn-block",{active:e,disabled:this.props.disabled}),s);y.href&&"button"===g&&(g="a");var w=c?"Close":null;return l.a.createElement(g,Object(n.a)({type:"button"===g&&y.onClick?"button":void 0},y,{className:E,ref:p,onClick:this.onClick,"aria-label":a||w}))},e}(l.a.Component);g.propTypes=v,g.defaultProps={color:"secondary",tag:"button"},e.a=g},768:function(t,e,a){}}]);
//# sourceMappingURL=137.b1534b08.chunk.js.map